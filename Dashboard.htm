<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... head без изменений ... -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<style>
    /* ... style без изменений ... */
</style>
<body>
    <div class="dashboard-container">
        <!-- ... структура без изменений ... -->
        <div class="block-c">
            <div class="block-c-top">
                <!-- Вернули исходный параграф -->
                <p id="os-text">Загрузка обратной связи...</p>
            </div>
            <div class="block-c-bottom">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTAxrOH3BsNrlwQ7MRFAM5YQfoyo4uSbgQVg&s" alt="Кот" class="cat-image">
            </div>
        </div>
        <!-- ... -->
    </div>

    <script>
        // === КОНСТАНТЫ И ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ===
        const supabaseUrl = '...'; // Ваш URL
        const supabaseKey = '...'; // Ваш ключ
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        // ... все остальные функции и константы (TAG_MAP, updateTagsTable и т.д.) ...
        
        // === ФИНАЛЬНАЯ ВЕРСИЯ ГЛАВНОЙ ФУНКЦИИ (без логов) ===
        async function fetchDashboardData(tableName) {
            let userIdentifier = null;
            let userIdentifierForDisplay = 'Неизвестный';

            if (window.Telegram && window.Telegram.WebApp) {
                const tgWebApp = window.Telegram.WebApp;
                tgWebApp.ready();
                const user = tgWebApp.initDataUnsafe?.user;
                if (user) {
                    if (user.username) {
                        userIdentifier = user.username;
                        userIdentifierForDisplay = `@${user.username}`;
                    } else if (user.id) {
                        userIdentifier = user.id.toString();
                        userIdentifierForDisplay = `ID: ${user.id}`;
                    }
                }
            } else {
                // Для локального тестирования
                userIdentifier = 'ВАШ_ТЕСТОВЫЙ_ТГ_ЛОГИН';
                userIdentifierForDisplay = `@${userIdentifier}`;
            }

            if (!userIdentifier) {
                document.getElementById('operator-name').textContent = 'Не удалось определить пользователя';
                return;
            }

            // ... остальная логика функции без изменений ...
            try {
                const { data, error } = await supabaseClient
                    .from(tableName)
                    .select(`...`) // Ваш список полей
                    .eq('tg', userIdentifier)
                    .single();

                if (error) {
                    if (error.code === 'PGRST116') {
                        document.getElementById('operator-name').textContent = `Пользователь не найден`;
                        document.getElementById('os-text').textContent = `Ваш идентификатор '${userIdentifierForDisplay}' не зарегистрирован в системе.`;
                    } else { throw error; }
                    return;
                }

                if (data) {
                    // === ОБНОВЛЕНИЕ ИНТЕРФЕЙСА ===
                    document.getElementById('os-text').textContent = data.OS ?? 'Обратная связь от оператора отсутствует.';
                    // ... все остальные обновления ...
                }
            } catch (error) {
                console.error(`Ошибка при загрузке данных:`, error.message);
                document.getElementById('operator-name').textContent = 'Ошибка загрузки';
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // ... код инициализации ...
            fetchDashboardData('TMday');
        });
    </script>
</body>
</html>
